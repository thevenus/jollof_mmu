----------------------------------------------------------------------------------
-- Company: 
-- Engineer: 
-- 
-- Create Date: 02/06/2024 09:37:00 AM
-- Design Name: 
-- Module Name: tb_jollof_top - Behavioral
-- Project Name: 
-- Target Devices: 
-- Tool Versions: 
-- Description: 
-- 
-- Dependencies: 
-- 
-- Revision:
-- Revision 0.01 - File Created
-- Additional Comments:
-- 
----------------------------------------------------------------------------------


library IEEE;
use IEEE.STD_LOGIC_1164.ALL;

-- Uncomment the following library declaration if using
-- arithmetic functions with Signed or Unsigned values
--use IEEE.NUMERIC_STD.ALL;

-- Uncomment the following library declaration if instantiating
-- any Xilinx leaf cells in this code.
--library UNISIM;
--use UNISIM.VComponents.all;
use std.textio.all;
use ieee.std_logic_textio.all;

entity tb_jollof_top is
--  Port ( );
end tb_jollof_top;

architecture Behavioral of tb_jollof_top is

    component jollof_top is
    
        Port ( clk : in STD_LOGIC;
           rst : in STD_LOGIC;
           input_data : in STD_LOGIC_VECTOR (7 downto 0);
           valid_input : in STD_LOGIC;
           read_ram : in STD_LOGIC;
           read_data_out : out STD_LOGIC_VECTOR (8 downto 0);
           finish : out STD_LOGIC);
           
    end component jollof_top;

    signal clk: std_logic:= '0';
    signal rst: std_logic:= '1';
    signal input_data: std_logic_vector (7 downto 0);
    signal read_ram: std_logic:= '0';
    signal read_data_out: std_logic_vector (8 downto 0);
    signal finish: std_logic;
    signal valid_input: std_logic;
    signal delay_sig: std_logic:= '0';

    constant CLK_PERIOD : time := 10ns;

begin

    DUT_jollof_top: jollof_top 
    port map(
        clk => clk,
        rst => rst,
        input_data => input_data,
        valid_input => valid_input,
        read_ram => read_ram,
        read_data_out => read_data_out,
        finish => finish
        ); 


    clk <= not clk after CLK_PERIOD/2;
    rst <= '0' after 100ns;
    valid_input <= '0', '1' after 1700ns, '0' after 1710ns;
    delay_sig <= '1' after 1690ns;
    
	-- input process
    process (clk, rst, delay_sig) is
        variable line_v : line;
        variable input_v : std_logic_vector(7 downto 0);
        file input_stimuli : text open READ_MODE is "/h/dc/o/si3116uw-s/icp1matrix/functional_model_stimuli/input_stimuli.txt";
    begin
        if (rising_edge(clk) and rst = '0' and delay_sig = '1') then
            -- file_open(input_stimuli, "/h/d9/n/fu6315ma-s/Documents/icp1matrix/functional_model_stimuli/input_stimuli.txt", READ_MODE);
            if (not endfile(input_stimuli)) then
                readline(input_stimuli, line_v);
                read(line_v, input_v);
                input_data <= input_v;
                -- report("input: " & to_string(input_v));
            end if;
            
            if (finish = '1') then 
                read_ram <= '1';
            end if;    
            
            -- file_close(input_stimuli);
        end if;
    end process;

	-- output process
	process (clk, read_ram, read_data_out) is
		file output_results : text open WRITE_MODE is "/h/dc/o/si3116uw-s/icp1matrix/jollof_sim/output.txt"
        variable line_v : line;
		variable flag : boolean;
	begin
		if (rising_edge(clk) and read_ram = '1' and read_data_out != 0) then
			write(line_v, read_data_out);
			writeline(output_results, line_v);		
		end if;
	end process; 

end Behavioral;
